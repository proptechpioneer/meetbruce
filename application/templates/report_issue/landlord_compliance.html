{% extends "layout.html" %}
{% load static %}

{% block title %}Bruce | Landlord Compliance Checklist{% endblock %}

{% block content %}
<div class="bg-gray-50 min-h-screen">
    <!-- Main Content -->
    <div class="max-w-5xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
        <!-- Header -->
        <div class="mb-8">
            <div class="flex items-center text-sm text-gray-500 mb-4">
                <a href="{% url 'report_issue:dashboard' %}" class="hover:text-gray-700">Report Issue</a>
                <i class="fas fa-chevron-right mx-2"></i>
                <span>Landlord Compliance Checklist</span>
            </div>
            <h1 class="text-3xl font-bold text-gray-900">Is My Landlord Compliant?</h1>
            <p class="mt-2 text-gray-600">
                Use this checklist to verify that your landlord is meeting their legal obligations. 
                Check off items that your landlord is currently complying with.
            </p>
        </div>

        <!-- Important Notice -->
        <div class="bg-blue-50 border-l-4 border-blue-400 p-4 mb-8">
            <div class="flex">
                <div class="shrink-0">
                    <i class="fas fa-info-circle text-blue-400"></i>
                </div>
                <div class="ml-3">
                    <p class="text-sm text-blue-700">
                        <strong>Important:</strong> Landlord obligations vary by location. This checklist covers common requirements, 
                        but you should verify local laws and regulations in your area. Consider consulting with local tenant rights 
                        organizations for specific guidance.
                    </p>
                </div>
            </div>
        </div>

        <!-- Compliance Checklist Form -->
        <form method="post" class="space-y-8">
            {% csrf_token %}
            
            {% for category, items in compliance_items.items %}
                <div class="bg-white shadow-lg rounded-lg overflow-hidden">
                    <div class="px-6 py-4 bg-gray-50 border-b border-gray-200">
                        <h3 class="text-lg font-semibold text-gray-900">{{ category }}</h3>
                    </div>
                    <div class="px-6 py-4">
                        <div class="space-y-4">
                            {% for item in items %}
                                <div class="flex items-start justify-between p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition duration-200">
                                    <div class="flex-1 min-w-0">
                                        <label class="text-sm font-medium text-gray-900 block mb-1">
                                            {{ item.text }}
                                        </label>
                                        <p class="text-sm text-gray-600">
                                            {{ item.description }}
                                        </p>
                                    </div>
                                    <div class="ml-6 flex space-x-4 shrink-0">
                                        <label class="flex items-center">
                                            <input type="radio" 
                                                   name="{{ item.id }}" 
                                                   value="yes" 
                                                   class="h-4 w-4 text-green-600 border-gray-300 focus:ring-green-500">
                                            <span class="ml-2 text-sm font-medium text-green-700">Yes</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="radio" 
                                                   name="{{ item.id }}" 
                                                   value="no" 
                                                   class="h-4 w-4 text-red-600 border-gray-300 focus:ring-red-500">
                                            <span class="ml-2 text-sm font-medium text-red-700">No</span>
                                        </label>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            {% endfor %}

            <!-- Submit Section -->
            <div class="bg-white shadow-lg rounded-lg p-6">
                <div class="flex justify-between items-center">
                    <div>
                        <h3 class="text-lg font-semibold text-gray-900">Complete Your Assessment</h3>
                        <p class="text-sm text-gray-600 mt-1">
                            Review your selections and submit to see your compliance results and recommendations.
                        </p>
                    </div>
                    <div class="flex space-x-3">
                        <a href="{% url 'report_issue:dashboard' %}" 
                           class="px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                            Cancel
                        </a>
                        <button type="submit" 
                                class="px-6 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                            <i class="fas fa-check mr-2"></i>
                            Submit Assessment
                        </button>
                    </div>
                </div>
            </div>
        </form>

        <!-- Help Section -->
        <div class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-6">
                <h3 class="text-lg font-medium text-yellow-900 mb-3">
                    <i class="fas fa-exclamation-triangle mr-2"></i>
                    What if my landlord isn't compliant?
                </h3>
                <ul class="text-yellow-800 text-sm space-y-2">
                    <li>• Document all issues with photos and written records</li>
                    <li>• Contact your landlord in writing to request compliance</li>
                    <li>• Keep copies of all communications</li>
                    <li>• Contact local housing authorities for serious violations</li>
                    <li>• Consider consulting with tenant rights organizations</li>
                </ul>
            </div>
            
            <div class="bg-green-50 border border-green-200 rounded-lg p-6">
                <h3 class="text-lg font-medium text-green-900 mb-3">
                    <i class="fas fa-lightbulb mr-2"></i>
                    Additional Resources
                </h3>
                <ul class="text-green-800 text-sm space-y-2">
                    <li>• Local tenant rights organizations</li>
                    <li>• Housing authority complaint processes</li>
                    <li>• Legal aid societies for low-income tenants</li>
                    <li>• State and local housing codes</li>
                    <li>• Tenant advocacy groups in your area</li>
                </ul>
            </div>
        </div>

        <!-- Progress Indicator -->
        <div class="mt-8 bg-white rounded-lg p-6 shadow-lg">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">Assessment Progress</h3>
            <div class="flex items-center justify-between text-sm text-gray-600 mb-2">
                <span>Items completed:</span>
                <span id="progress-text">0 of {{ compliance_items.values|length|add:0 }} categories</span>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-2">
                <div id="progress-bar" class="bg-blue-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
            </div>
        </div>
    </div>

    <script>
        // Track progress through the checklist
        function updateProgress() {
            const categories = document.querySelectorAll('.bg-white.shadow-lg.rounded-lg.overflow-hidden');
            const totalCategories = categories.length - 2; // Exclude submit section and progress section
            let completedCategories = 0;

            categories.forEach((category, index) => {
                if (index >= totalCategories) return; // Skip submit and progress sections
                
                const checkboxes = category.querySelectorAll('input[type="checkbox"]');
                const checkedBoxes = category.querySelectorAll('input[type="checkbox"]:checked');
                
                if (checkedBoxes.length > 0) {
                    completedCategories++;
                }
            });

            const progressPercentage = (completedCategories / totalCategories) * 100;
            document.getElementById('progress-bar').style.width = progressPercentage + '%';
            document.getElementById('progress-text').textContent = 
                completedCategories + ' of ' + totalCategories + ' categories';
        }

        // Add event listeners to all checkboxes
        document.addEventListener('DOMContentLoaded', function() {
            const checkboxes = document.querySelectorAll('input[type="checkbox"]');
            checkboxes.forEach(checkbox => {
                checkbox.addEventListener('change', updateProgress);
            });
            
            // Initial progress update
            updateProgress();
        });

        // Add visual feedback for checked items
        document.addEventListener('change', function(e) {
            if (e.target.type === 'checkbox') {
                const container = e.target.closest('.flex.items-start.space-x-3');
                if (e.target.checked) {
                    container.classList.add('bg-green-50', 'border-green-200');
                    container.classList.remove('border-gray-200');
                } else {
                    container.classList.remove('bg-green-50', 'border-green-200');
                    container.classList.add('border-gray-200');
                }
            }
        });
    </script>
</div>
{% endblock %}